services:
  mcp-kimi2:
    image: nvidia/cuda:12.4.1-runtime-ubuntu22.04
    container_name: mcp-kimi2
    restart: unless-stopped
    ipc: host
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    gpus: all
    volumes:
      - /data/mcp/models:/models
      - /data/mcp/cache:/cache
      - /data/mcp:/workspace
    working_dir: /workspace
    command: ["sleep","infinity"]

  mcp-qdrant:
    image: qdrant/qdrant:v1.12.4
    container_name: mcp-qdrant
    restart: unless-stopped
    volumes:
      - /data/mcp/qdrant:/qdrant/storage
    ports:
      - "6334:6333"

  mcp-api:
    image: python:3.11-slim
    container_name: mcp-api
    restart: unless-stopped
    working_dir: /app
    volumes:
      - /data/mcp/fastapi:/app
    command: /bin/sh -lc "pip install -q fastapi uvicorn && uvicorn main:app --host 0.0.0.0 --port 8010"
    ports:
      - "8010:8010"
