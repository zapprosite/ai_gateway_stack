services:
  kimi2:
    image: nvidia/cuda:12.4.1-runtime-ubuntu22.04
    container_name: kimi2
    restart: unless-stopped
    ipc: host
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    gpus: all
    volumes:
      - /data/models:/models
      - /data/cache:/cache
      - /data:/workspace
    working_dir: /workspace
    command: ["sleep","infinity"]

  qdrant:
    image: qdrant/qdrant:v1.12.4
    container_name: qdrant
    volumes:
      - /data/qdrant:/qdrant/storage
    ports:
      - "6333:6333"
    restart: unless-stopped

  fastapi:
    image: python:3.11-slim
    container_name: fastapi
    working_dir: /app
    volumes:
      - /data/fastapi:/app
    command: /bin/sh -lc "pip install -q fastapi uvicorn && uvicorn main:app --host 0.0.0.0 --port 8000"
    ports:
      - "8000:8000"
    restart: unless-stopped
